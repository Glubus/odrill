{% extends "base.html" %}

{% import "components/molecules/_download_badge.html" as badge %}
{% import "components/molecules/_copy_text.html" as copy %}
{% import "components/molecules/_empty_state.html" as empty %}

{% block title %}{{ package.name }}{% endblock %}

{% block content %}

<script src="/static/js/vendor/echarts.min.js"></script>

<div class="container">
    <div class="package-main-content">
        <div class="inner-content-grid">
            <div class="left-column">
                <div class="package-card-header">
                    <div>
                        <h1 class="package-name" style="font-size: 2.5rem;">{{ package.name }}</h1>
                        <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                            <i data-lucide="user" style="width:16px;height:16px;display:inline;vertical-align:text-bottom;"></i>
                            {{ package.author | default(value="Unknown") }}
                        </p>
                    </div>
                    <div style="text-align: right;">
                        <div class="package-version" style="font-size: 1.1rem; margin-bottom: 0.5rem;">v{{ package.latest_version }}</div>
                        {{ badge::render(count=package.downloads | default(value=0)) }}
                    </div>
                </div>

                {% if package.description %}
                <p class="package-desc" style="margin: 1.5rem 0; font-size: 1.1rem;">{{ package.description }}</p>
                {% endif %}

                {{ copy::render(text="odrill add " ~ package.name) }}

                <div class="chart-container">
                    <h3 style="margin-bottom: 1rem;">Download History (90 Days)</h3>
                    <div id="downloadChart" style="width: 100%; height: 250px;" data-history='{{ download_history | json_encode() | safe }}'></div>
                </div>
            </div>

            <div class="versions-sidebar-inner">
                <h2 style="font-size: 1.25rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                    <i data-lucide="history"></i>
                    Versions
                </h2>
                
                <div class="versions-scrollable">
                    {% for v in versions %}
                    <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--border);">
                        <span style="font-family: var(--font-mono); font-size: 0.9rem;">
                            {{ v.version }}
                            {% if v.yanked %}<span style="color: var(--error); margin-left: 0.5rem;">(yanked)</span>{% endif %}
                        </span>
                        <span style="color: var(--text-muted); font-size: 0.8rem;">{{ v.created_at }}</span>
                    </div>
                    {% endfor %}
                    {% if versions | length == 0 %}
                        {{ empty::render(
                            title="No versions",
                            message="None found",
                            icon="history"
                        ) }}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/static/js/package-chart.js"></script>
{% endblock %}
